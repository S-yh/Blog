(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{383:function(t,s,a){"use strict";a.r(s);var n=a(42),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[t._v("#")]),t._v(" Nginx")]),t._v(" "),a("p",[t._v("Nginx是开源，高性能，高可靠的Web和反向代理服务器， 支持热部署， 几乎可以做到7 * 24小时不间断运行，即使运行几个月也不需要重新启动。"),a("br"),t._v("\n性能是Nginx最重要的考量，其占用内存少，并发能力强，能支持高达5W个并发连接数。")]),t._v(" "),a("h2",{attrs:{id:"nginx用途"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx用途"}},[t._v("#")]),t._v(" Nginx用途")]),t._v(" "),a("ul",[a("li",[t._v("静态资源服务：通过本地文件系统提供服务")]),t._v(" "),a("li",[t._v("反向代理服务：延伸出包括缓存，负载均衡等")]),t._v(" "),a("li",[t._v("API服务：OpenResty")])]),t._v(" "),a("h2",{attrs:{id:"简单请求和非简单请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简单请求和非简单请求"}},[t._v("#")]),t._v(" 简单请求和非简单请求")]),t._v(" "),a("ul",[a("li",[t._v("简单请求\n"),a("ul",[a("li",[t._v("请求方法是"),a("code",[t._v("HEAD")]),t._v(", "),a("code",[t._v("GET")]),t._v(", "),a("code",[t._v("POST")]),t._v(" 三种之一")]),t._v(" "),a("li",[a("code",[t._v("content-type")]),t._v("限于三个值："),a("code",[t._v("application/x-www-form-urlencoded")]),t._v("，"),a("code",[t._v("multipart/form-data")]),t._v("，"),a("code",[t._v("text/plain")])])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("对于简单请求浏览器会在头信息中增加Origin字段后直接发出, Origin字段用来说明本次请求来自的那个源(协议+域名+端口)。"),a("br"),t._v("\n如果服务器发现origin指定的源不在许可范围内, 服务器会返回一个正常的HTTP响应, 响应头信息没有包含"),a("code",[t._v("Access-Control-Allow-Origin")]),t._v("字段,抛出一个XHR的"),a("code",[t._v("error")]),t._v("事件。"),a("br"),t._v("\n如果Origin指定的域名在许可范围内, 服务器响应会多出几个"),a("code",[t._v("Access-Control-")]),t._v("开头的头信息字段。")])]),t._v(" "),a("ul",[a("li",[t._v("非简单请求(非简单请求是那种对服务器有特殊要求的请求)\n"),a("ul",[a("li",[t._v("请求方法是: "),a("code",[t._v("PUT")]),t._v(", "),a("code",[t._v("DELETE")])]),t._v(" "),a("li",[a("code",[t._v("Content-Type")]),t._v("值为: "),a("code",[t._v("application/json")])])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("对于非简单请求, 浏览器在正式通信之前, 发送一次HTTP预检OPTIONS请求, 先询问服务器, 当前域名是否在服务器的许可名单中, 以及使用哪些HTTP请求方法和头信息, 只有得到肯定答复, 浏览器才会发出正式的"),a("code",[t._v("XHR")]),t._v("请求,否则报错")])]),t._v(" "),a("h2",{attrs:{id:"正向代理与反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#正向代理与反向代理"}},[t._v("#")]),t._v(" 正向代理与反向代理")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("正向代理"),a("br"),t._v("\n一般的访问流程是客户端直接向目标服务器发送请求并获取内容, 使用正向代理后, 客户端改为向代理服务器发送请求,并指定目标服务器,然后由代理服务器和原始服务器通信, 转交请求并获得内容,再返回给客户端, 正向代理隐藏了真实的客户端, 为客户端转发请求, 使真实客户端对服务器不可见.")])]),t._v(" "),a("li",[a("p",[t._v("反向代理"),a("br"),t._v("\n与一般访问流程相比, 使用反向代理后, 直接收到请求的服务器是代理服务器, 然后将请求转发给内部网络上真正进行处理的服务器,得到的结果返回给客户端, 反向代理隐藏了真实的服务器, 为服务器收发请求,是真实服务器对客户端不可见, 一般在处理跨域请求的时候比较常用,")])])]),t._v(" "),a("p",[t._v("一般来说, 给客户端做代理的都是正向代理, 给服务器代理的都是反向代理")]),t._v(" "),a("h2",{attrs:{id:"nginx常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx常用命令"}},[t._v("#")]),t._v(" Nginx常用命令")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("nginx -s reload "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#重新加载配置文件, 热重启")]),t._v("\nnginx -s reopen "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#重启ngixn")]),t._v("\nnginx -s stop   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#快速关闭")]),t._v("\nnginx -s quit   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#等待工作进程处理完成后关闭")]),t._v("\nnginx -T        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看当前nginx配置")]),t._v("\nnginx -t -c "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("配置路径"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#检查配置是否有问题")]),t._v("\n")])])]),a("h2",{attrs:{id:"nginx配置语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置语法"}},[t._v("#")]),t._v(" Nginx配置语法")]),t._v(" "),a("ul",[a("li",[t._v("nginx主配置文件结构")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("main        # 全局配置，对全局生效   \n├── events  # 配置影响 Nginx 服务器或与用户的网络连接  \n├── http    # 配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置  \n│   ├── upstream # 配置后端服务器具体地址，负载均衡配置不可或缺的部分  \n│   ├── server   # 配置虚拟主机的相关参数，一个 http 块中可以有多个 server 块  \n│   ├── server  \n│   │   ├── location  # server 块可以包含多个 location 块，location 指令用于匹配 uri  \n│   │   ├── location  \n│   │   └── ...  \n│   └── ...  \n└── ...  \n")])])]),a("ul",[a("li",[a("p",[t._v("语法规则")]),t._v(" "),a("ul",[a("li",[t._v("配置文件由指令与指令块构成")]),t._v(" "),a("li",[t._v("每条指令以 "),a("code",[t._v(";")]),t._v("结尾, 指令与参数间以空格符号分隔")]),t._v(" "),a("li",[t._v("指令块以"),a("code",[t._v("{}")]),t._v("大括号将多条指令组织在一起")]),t._v(" "),a("li",[a("code",[t._v("include")]),t._v(" 语句允许组合多个配置文件以提升可维护性")]),t._v(" "),a("li",[t._v("使用"),a("code",[t._v("#")]),t._v("添加注释")]),t._v(" "),a("li",[t._v("使用"),a("code",[t._v("$")]),t._v("符号使用变量")]),t._v(" "),a("li",[t._v("部分指令的参数支持正则表达式")]),t._v(" "),a("li",[t._v("server块可以包含多个location块, location指令用于匹配uri\n"),a("ul",[a("li",[a("code",[t._v("=")]),t._v(" 精确匹配路径,用于不含正则表达式的uri前, 匹配成功则不再后续的查找")]),t._v(" "),a("li",[a("code",[t._v("^~")]),t._v(" 用于不含正则表达式的uri前, 表示如果该符号后面的字符是最佳匹配, 采用该规则, 不再进行后续的查找")]),t._v(" "),a("li",[a("code",[t._v("~")]),t._v(" 表示用该符号后面的正则去匹配路径, 区分大小写")]),t._v(" "),a("li",[a("code",[t._v("~*")]),t._v(" 表示用该符号后面的正则去匹配路径, 不区分大小写,")]),t._v(" "),a("li",[t._v("如果uri包含正则表达式, 必须要有 "),a("code",[t._v("~")]),t._v("或"),a("code",[t._v("~*")])])])])])]),t._v(" "),a("li",[a("p",[t._v("全局变量")])])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("全局变量名")]),t._v(" "),a("th",[t._v("功能")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("$host")]),t._v(" "),a("td",[t._v("请求信息中的Host,不包含端口")])]),t._v(" "),a("tr",[a("td",[t._v("$request_method")]),t._v(" "),a("td",[t._v("客户端请求类型")])]),t._v(" "),a("tr",[a("td",[t._v("$remote_addr")]),t._v(" "),a("td",[t._v("客户端IP地址")])]),t._v(" "),a("tr",[a("td",[t._v("$remote_port")]),t._v(" "),a("td",[t._v("客户端的端口")])]),t._v(" "),a("tr",[a("td",[t._v("$args")]),t._v(" "),a("td",[t._v("请求中的参数")])]),t._v(" "),a("tr",[a("td",[t._v("$args_PARAMETER")]),t._v(" "),a("td",[t._v("GET请求中变量名参数的值")])]),t._v(" "),a("tr",[a("td",[t._v("$content-length")]),t._v(" "),a("td",[t._v("请求中的Contetn-length字段")])]),t._v(" "),a("tr",[a("td",[t._v("$http_user_agent")]),t._v(" "),a("td",[t._v("客户端agent信息")])]),t._v(" "),a("tr",[a("td",[t._v("$http_cookie")]),t._v(" "),a("td",[t._v("客户端cookie信息")])]),t._v(" "),a("tr",[a("td",[t._v("$server_protocol")]),t._v(" "),a("td",[t._v("请求使用的协议")])]),t._v(" "),a("tr",[a("td",[t._v("$server_name")]),t._v(" "),a("td",[t._v("服务器名称")])]),t._v(" "),a("tr",[a("td",[t._v("$server_addr")]),t._v(" "),a("td",[t._v("服务器地址")])]),t._v(" "),a("tr",[a("td",[t._v("$server_port")]),t._v(" "),a("td",[t._v("服务器端口")])]),t._v(" "),a("tr",[a("td",[t._v("$scheme")]),t._v(" "),a("td",[t._v("http方法(https,http)")])])])]),t._v(" "),a("h2",{attrs:{id:"配置反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置反向代理"}},[t._v("#")]),t._v(" 配置反向代理")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/b010c9302cd0",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server_name _"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        proxy_pass http://s-yh.cn:9999"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n包含以下四种情况 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("假设访问地址: http://192.168.1.1/proxy/test.html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n第一种：\nlocation /proxy/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  proxy_pass http://127.0.0.1/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n代理到URL：http://127.0.0.1/test.html\n\n第二种（相对于第一种，最后少一个 / ）\nlocation /proxy/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  proxy_pass http://127.0.0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n代理到URL：http://127.0.0.1/proxy/test.html\n\n第三种：\nlocation /proxy/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  proxy_pass http://127.0.0.1/aaa/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n代理到URL：http://127.0.0.1/aaa/test.html\n\n第四种（相对于第三种，最后少一个 / ）\nlocation /proxy/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  proxy_pass http://127.0.0.1/aaa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n代理到URL：http://127.0.0.1/aaatest.html\n\n")])])]),a("ul",[a("li",[t._v("反向代理其他指令\n"),a("ul",[a("li",[a("code",[t._v("proxy_set_header")]),t._v(": 在将客户端请求发送到服务器之前,更改来自客户端的请求头信息")]),t._v(" "),a("li",[a("code",[t._v("proxy_connerct_timeout")]),t._v(": 配置Nginx与后端代理服务器尝试建立连接的超时时间")]),t._v(" "),a("li",[a("code",[t._v("proxy_read_timeout")]),t._v(": 配置nginx向后端服务器组发出read请求后,等待响应的超时时间")]),t._v(" "),a("li",[a("code",[t._v("proxy_send_timeout")]),t._v(": 配置nginx向后端服务器组发出write请求后,等待响应的超时时间")]),t._v(" "),a("li",[a("code",[t._v("proxy_redirect")]),t._v(": 用于修改后端服务器返回的响应头中的Location和Refresh")])])])]),t._v(" "),a("h2",{attrs:{id:"跨域cros配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域cros配置"}},[t._v("#")]),t._v(" 跨域CROS配置")]),t._v(" "),a("ul",[a("li",[t._v("使用反向代理解决跨域")]),t._v(" "),a("li",[t._v("配置header解决跨域")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server_name  be.sherlocked93.club"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \n\tadd_header "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Origin'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_origin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 全局变量获得当前请求origin，带cookie的请求不支持*")]),t._v("\n\tadd_header "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Credentials'")]),t._v("'true"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("';    # 为 true 可带上 cookie\n\tadd_header '")]),t._v("Access-Control-Allow-Methods"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v("GET, POST, OPTIONS"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("';  # 允许请求方法\n\tadd_header '")]),t._v("Access-Control-Allow-Headers"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_access_control_request_headers")]),t._v(";  # 允许请求的 header，可以为 *\n\tadd_header '")]),t._v("Access-Control-Expose-Headers"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v("Content-Length,Content-Range"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("';\n\t\n  if ("),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_method")]),t._v(" = '")]),t._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("') {\n\t\tadd_header '")]),t._v("Access-Control-Max-Age"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("' 1728000;   # OPTIONS 请求的有效期，在有效期内不用发出另一条预检请求\n\t\tadd_header '")]),t._v("Content-Type"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v("text/plain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("charset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf-8"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("';\n\t\tadd_header '")]),t._v("Content-Length' "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n\t\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("204")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 200 也可以")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  \n\tlocation / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\troot  /usr/share/nginx/html/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tindex index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"开启gzip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开启gzip"}},[t._v("#")]),t._v(" 开启gzip")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("gzip")]),t._v(" on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认off，是否开启gzip")]),t._v("\ngzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 上面两个开启基本就能跑起了，下面的愿意折腾就了解一下")]),t._v("\ngzip_static on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ngzip_proxied any"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ngzip_vary on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ngzip_comp_level "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ngzip_buffers "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(" 8k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# gzip_min_length 1k;")]),t._v("\ngzip_http_version "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),a("ul",[a("li",[t._v("gzip_types: 要采用gzip压缩的MIME文件类型, 其中text/html被系统强制启用")]),t._v(" "),a("li",[t._v("gzip_static: 默认off, 该模块启用后,Nginx首先检查是够存在请求静态文件的gz结尾的文件, 如果有直接返回改"),a("code",[t._v(".gz")]),t._v("文件内容")]),t._v(" "),a("li",[t._v("gzip_proxied: 默认off, nginx作为反向代理时启用, 用于设置启用或禁用从代理服务器上收到响应内容gzip压缩")]),t._v(" "),a("li",[t._v("gzip_vary：用于在响应消息头中添加 Vary：Accept-Encoding，使代理服务器根据请求头中的 Accept-Encoding 识别是否启用 gzip 压缩；")]),t._v(" "),a("li",[t._v("gzip_comp_level：gzip 压缩比，压缩级别是 1-9，1 压缩级别最低，9 最高，级别越高压缩率越大，压缩时间越长，建议 4-6；")]),t._v(" "),a("li",[t._v("gzip_buffers：获取多少内存用于缓存压缩结果，16 8k 表示以 8k*16 为单位获得；")]),t._v(" "),a("li",[t._v("gzip_min_length：允许压缩的页面最小字节数，页面字节数从header头中的 Content-Length 中进行获取。默认值是 0，不管页面多大都压缩。建议设置成大于 1k 的字节数，小于 1k 可能会越压越大；")]),t._v(" "),a("li",[t._v("gzip_http_version：默认 1.1，启用 gzip 所需的 HTTP 最低版本；")])]),t._v(" "),a("p",[t._v("webpack的gzip配置")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" CompressionWebpackPlugin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'compression-webpack-plugin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// gzip 配置")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("configureWebpack")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 生产环境")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        plugins"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CompressionWebpackPlugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/\\.js$|\\.html$|\\.css/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 匹配文件名")]),t._v("\n          threshold"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10240")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 文件压缩阈值，对超过10k的进行压缩")]),t._v("\n          deleteOriginalAssets"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 是否删除源文件")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"配置负载均衡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置负载均衡"}},[t._v("#")]),t._v(" 配置负载均衡")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("http "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  upstream myserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ip_hash;  # ip_hash 方式")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# fair;     # fair 方式")]),t._v("\n    server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:8081"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 负载均衡目的服务地址")]),t._v("\n    server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:8080"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:8082 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("weight")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# weight 方式，不写默认为 1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n \n  server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        proxy_pass http://myserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        proxy_connect_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Nginx提供了几种分配方式, 默认为轮询,")]),t._v(" "),a("ul",[a("li",[t._v("轮询: 每个请求按时间顺序逐一分配")]),t._v(" "),a("li",[t._v("weight: 权重分配, 权重越高,被访问的概率越大")]),t._v(" "),a("li",[t._v("ip_hash: 每个请求按访问的IP的hash结果分配, 这样每个访客固定访问一个后端服务器,可以解决动态网页session共享问题")]),t._v(" "),a("li",[t._v("fair: 按后端服务器的响应时间分配, 响应时间短的优先分配, 依赖第三方插件 "),a("code",[t._v("nginx-upstream-fair")])])]),t._v(" "),a("h2",{attrs:{id:"适配pc或移动设备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#适配pc或移动设备"}},[t._v("#")]),t._v(" 适配PC或移动设备")]),t._v(" "),a("p",[t._v("根据用户请求的user-agent来判断是pc还是H5站点")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\tserver_name _"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\tlocation / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t    root  /usr/share/nginx/html/pc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_user_agent")]),t._v(" ~* "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'(Android|webOS|iPhone|iPod|BlackBerry)'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root /usr/share/nginx/html/mobile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\tindex index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"配置https"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置https"}},[t._v("#")]),t._v(" 配置https")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("ssl_certificate /etc/nginx/https/1_sherlocked93.club_bundle.crt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 证书文件地址")]),t._v("\nssl_certificate_key /etc/nginx/https/2_sherlocked93.club.key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 私钥文件地址")]),t._v("\n\nssl_session_timeout 10m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nssl_protocols TLSv1 TLSv1.1 TLSv1.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#请按照以下协议配置")]),t._v("\nssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("aNULL:"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("MD5:"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("RC4:"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("DHE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nssl_prefer_server_ciphers on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nadd_header X-Frame-Options DENY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 减少点击劫持")]),t._v("\nadd_header X-Content-Type-Options nosniff"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 禁止服务器自动解析资源类型")]),t._v("\nadd_header X-Xss-Protection "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 防XSS攻击")]),t._v("\n")])])]),a("h2",{attrs:{id:"图片防盗链"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#图片防盗链"}},[t._v("#")]),t._v(" 图片防盗链")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server_name  _"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 图片防盗链")]),t._v("\n  location ~* "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gif"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("jpg"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("jpeg"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("png"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("bmp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("swf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    valid_referers none blocked "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 只允许本机 IP 外链引用")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$invalid_referer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("403")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"请求过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#请求过滤"}},[t._v("#")]),t._v(" 请求过滤")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 非指定请求全返回 403")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_method")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("~ ^"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GET"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("POST"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("HEAD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("403")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nlocation / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# IP访问限制（只允许IP是 192.168.0.2 机器访问）")]),t._v("\n  allow "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  deny all"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \n  root   html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  index  index.html index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"单页面history路由配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单页面history路由配置"}},[t._v("#")]),t._v(" 单页面history路由配置")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server_name  _"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \n  location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    root       /usr/share/nginx/html/dist"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vue 打包后的文件夹")]),t._v("\n    index      index.html index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    try_files  "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),t._v("/ /index.html @rewrites"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    expires -1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 首页一般没有强制缓存")]),t._v("\n    add_header Cache-Control no-cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 接口转发，如果需要的话")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#location ~ ^/api {")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  proxy_pass http://_;")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#}")]),t._v("\n  \n  location @rewrites "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    rewrite ^"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(".+"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ /index.html "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"http请求转发到https"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http请求转发到https"}},[t._v("#")]),t._v(" http请求转发到https")]),t._v(" "),a("p",[t._v("配置完https后, 浏览器还是可以访问http的地址的, 可以做一个301跳转, 把对应域名的http请求重定向到https上")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server_name s-yh.cn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 单域名重定向")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s-yh.cn'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" https://s-yh.cn"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 全局非 https 协议时重定向")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$scheme")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" https://"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$server_name")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或者全部重定向")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" https://"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$server_name")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 以上配置选择自己需要的即可，不用全部加")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"泛域名路径分离"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#泛域名路径分离"}},[t._v("#")]),t._v(" 泛域名路径分离")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server_name  ~^"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("w-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("+"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(".doc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(".sherlocked93"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(".club$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    root /usr/share/nginx/html/doc/"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"泛域名转发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#泛域名转发"}},[t._v("#")]),t._v(" 泛域名转发")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server_name ~^"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("w-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("+"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(".serv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(".sherlocked93"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(".club$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        proxy_set_header        X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        proxy_set_header        X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        proxy_set_header        Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        proxy_set_header        X-NginX-Proxy "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        proxy_pass              http://127.0.0.1:8080/"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"nginx发布程序浏览器缓存html文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx发布程序浏览器缓存html文件"}},[t._v("#")]),t._v(" Nginx发布程序浏览器缓存html文件")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("location ~ .*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("htm"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("?$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 增加缓存")]),t._v("\n  add_header Cache-Control "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private, no-store, no-cache, must-revalidate, proxy-revalidate"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  access_log on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("通过以上配置.可以保证"),a("code",[t._v("html页面不被缓存, 在每次发布新版本的时候,保证用户加载最新版本页面.")])])])}),[],!1,null,null,null);s.default=e.exports}}]);